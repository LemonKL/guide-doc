<div class="wrap" data-blogid="">

<div class="text-center block hidden-xs">
<script type="text/javascript">
OA_show(2);
</script><div style="line-height: 0; background: #FAFAFA">
<div class="container text-center" style="position: relative;">
<a href="https://segmentfault.com/user/login" class="small text-muted" style="position: absolute; top: 10px; right: 15px;">登录免广告</a><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 导航下横幅广告（大型） -->
<ins class="adsbygoogle" style="display:inline-block;width:970px;height:90px" data-ad-client="ca-pub-6330872677300335" data-ad-slot="6450634185" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:970px;background-color:transparent;"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:970px;background-color:transparent;"><iframe width="970" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;border:0px;width:970px;height:90px;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="beacon_b17e9b7226" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=43&amp;campaignid=1&amp;zoneid=2&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=b17e9b7226" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div>
</div>

</div>

<div class="container mt15" style="position:relative">
<div class="row">
<div class="col-xs-12 col-md-9 main ">
<ol class="breadcrumb mb15">
<li><a href="/blogs">专栏</a></li>
<li class="active">文章详情</li>
</ol>
<div class="post-topheader custom- pt0">
<div class="mb20">
<div class="block-for-right-border">
<div class="row">
<div class="col-md-12 col-sm-12 col-xs-12">


<div class="post-topheader__info" data-username="哈希表演艺术家" data-userslug="hash_artist" data-useravatar="https://cdn.segmentfault.com/v-5d2ffc9a/global/img/user-64.png">


<div class="article__author clearfix">
<div class="article__authorleft">
<a href="/u/hash_artist">
<img class="avatar-40" src="https://cdn.segmentfault.com/v-5d2ffc9a/global/img/user-64.png" alt="哈希表演艺术家">
</a>
</div>
<div class="article__authorright">
<div class="article__authormeta">
<a href="/u/hash_artist" class="mr5"><strong>哈希表演艺术家</strong></a>


<img src="https://cdn.segmentfault.com/v-5d2ffc9a/global/img/rp.svg" class="mr5"><span style="color:#BF7158" class="mr10">3</span>



<span class="hidden-xs">
                                                            <button type="button" class="btn btn-xs btn-success follow-user" data-do="follow" data-type="user" data-id="1030000004989641">关注作者
</button>
                                                    </span>
</div>

<span style="display: block">
2019-04-12 发布
</span>
</div>
</div>

<h1 class="h1 post-topheader__info--title" id="articleTitle" data-id="1190000018844326">
<a href="/a/1190000018844326"> Paxos共识算法详解</a>
</h1>

<div class="content__tech hidden-xs">
<a href="" class="blog-type-common blog-type-1-before" target="_blank" data-content="
原创
"></a>

<ul class="taglist--inline inline-block article__title--tag mr10">
    <li class="tagPopup mb5">
<a class="tag" href="/t/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/blogs" data-toggle="popover" data-img="" data-placement="top" data-original-title="分布式系统" data-id="1040000003109075">
                      分布式系统
</a>
</li>
    <li class="tagPopup mb5">
<a class="tag" href="/t/%E5%8C%BA%E5%9D%97%E9%93%BE/blogs" data-toggle="popover" data-img="" data-placement="top" data-original-title="区块链" data-id="1040000004890636">
                      区块链
</a>
</li>
    <li class="tagPopup mb5">
<a class="tag" href="/t/%E5%90%8E%E7%AB%AF/blogs" data-toggle="popover" data-img="" data-placement="top" data-original-title="后端" data-id="1040000000391379">
                      后端
</a>
</li>
</ul>

<span>
402 次阅读
&nbsp;·&nbsp;
读完需要 21 分钟 
</span>
</div>
</div>
</div>
</div>
</div>
</div>
</div><!-- end .post-topheader -->

<div class="visible-lg">
<div class="side-widget" style="display: flex;">
<div class="stream__item-zan btn btn-default mt0 mb15 ml0 mr0 pt0 pb0 pl0 pr0 " id="side-widget-votes-btn">
<span class="stream__item-zan-icon"></span>
<span class="stream__item-zan-number" id="side-widget-votes-num">1</span>
</div>

<i class="fa fa-bookmark item " id="side-widget-bookmarks-btn"></i>
<i class="fa fa-weibo item"></i>
<i class="fa fa-weixin item" data-toggle="popover" data-placement="right" data-original-title="" title=""></i>
<i class="fa fa-twitter item"></i>
<i class="fa fa-facebook item"></i>
<i class="fa fa-arrow-up item hidden"></i>
</div>
</div>


<div class="article fmt article__content" data-id="1190000018844326" data-license="">

<p>在一个分布式系统中，由于节点故障、网络延迟等各种原因，根据CAP理论，我们只能保证<strong>一致性（Consistency）、可用性（Availability）、分区容错性（Partition Tolerance）</strong>中的两个。</p>
<p>对于一致性要求高的系统，比如银行取款机，就会选择牺牲可用性，故障时拒绝服务。MongoDB、Redis、MapReduce使用这种方案。</p>
<p>对于静态网站、实时性较弱的查询类数据库，会牺牲一致性，允许一段时间内不一致。简单分布式协议Gossip，数据库CouchDB、Cassandra使用这种方案。</p>
<p><span class="img-wrap"><img data-src="/img/bVbrepW?w=828&amp;h=212" src="/img/bVbrepW?w=828&amp;h=212" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图1</blockquote>
<p>如图1所示，一致性问题，可以根据是否存在恶意节点分类两类。无恶意节点，是指节点会丢失、重发、不响应消息，但不会篡改消息。而恶意节点可能会篡改消息。有恶意节点的问题称为拜占庭将军问题，不在今天的讨论范围。Paxos很好地解决了无恶意节点的分布式一致性问题。</p>
<h2 id="articleHeader0">背景</h2>
<p>1990年，Leslie Lamport在论文《The Part-Time Parliament》中提出Paxos算法。由于论文使用故事的方式，没有使用数学证明，起初并没有得到重视。直到1998年该论文才被正式接受。后来2001年Lamport又重新组织了论文，发表了<a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf" rel="nofollow noreferrer" target="_blank">《Paxos Made Simple》</a>。作为分布式系统领域的早期贡献者，Lamport获得了2013年图灵奖。</p>
<p>Paxos算法广泛应用在分布式系统中，Google Chubby的作者Mike Burrows说：“这个世界上只有一种一致性算法，那就是 Paxos（There is only one consensus protocol, and that's Paxos）”。</p>
<p>后来的Raft算法、是对Paxos的简化和改进，变得更加容易理解和实现。</p>
<h2 id="articleHeader1">Paxos类型</h2>
<p>Paxos本来是虚构故事中的一个小岛，议会通过表决来达成共识。但是议员可能离开，信使可能走丢，或者重复传递消息。对应到分布式系统的节点故障和网络故障。</p>
<p><span class="img-wrap"><img data-src="/img/bVbrepZ?w=585&amp;h=222" src="/img/bVbrepZ?w=585&amp;h=222" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图2</blockquote>
<p>如图2所示，假设议员要提议中午吃什么。如果有一个或者多个人同时提议，但一次只能通过一个提议，这就是Basic Paxos，是Paxos中最基础的协议。</p>
<p>显然Basic Paxos是不够高效的，如果将Basic Paxos并行起来，同时提出多个提议，比如中午吃什么、吃完去哪里嗨皮、谁请客等提议，议员也可以同时通过多个提议。这就是Multi-Paxos协议。</p>
<h2 id="articleHeader2">Basic Paxos</h2>
<h3 id="articleHeader3">角色</h3>
<p>Paxos算法存在3种角色：Proposer、Acceptor、Learner，在实现中一个节点可以担任多个角色。</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqe?w=353&amp;h=94" src="/img/bVbreqe?w=353&amp;h=94" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图3</blockquote>
<ul>
<li>Proposer负责提出提案</li>
<li>Acceptor负责对提案进行投票</li>
<li>Learner获取投票结果，并帮忙传播</li>
</ul>
<p>Learner不参与投票过程，为了简化描述，我们直接忽略掉这个角色。</p>
<h3 id="articleHeader4">算法</h3>
<p>运行过程分为两个阶段，Prepare阶段和Accept阶段。</p>
<p>Proposer需要发出两次请求，Prepare请求和Accept请求。Acceptor根据其收集的信息，接受或者拒绝提案。</p>
<p><strong>Prepare阶段</strong></p>
<ul>
<li>Proposer选择一个提案编号n，发送Prepare(n)请求给超过半数（或更多）的Acceptor。</li>
<li>Acceptor收到消息后，如果n比它之前见过的编号大，就回复这个消息，而且以后不会接受小于n的提案。另外，如果之前已经接受了小于n的提案，回复那个提案编号和内容给Proposer。</li>
</ul>
<p><strong>Accept阶段</strong></p>
<ul>
<li>当Proposer收到超过半数的回复时，就可以发送Accept(n, value)请求了。 n就是自己的提案编号，value是Acceptor回复的最大提案编号对应的value，如果Acceptor没有回复任何提案，value就是Proposer自己的提案内容。</li>
<li>Acceptor收到消息后，如果n大于等于之前见过的最大编号，就记录这个提案编号和内容，回复请求表示接受。</li>
<li>当Proposer收到超过半数的回复时，说明自己的提案已经被接受。否则回到第一步重新发起提案。</li>
</ul>
<p>完整算法如图4所示：</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqm?w=679&amp;h=401" src="/img/bVbreqm?w=679&amp;h=401" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图4</blockquote>
<p>Acceptor需要持久化存储minProposal、acceptedProposal、acceptedValue这3个值。</p>
<h3 id="articleHeader5">三种情况</h3>
<p>Basic Paxos共识过程一共有三种可能的情况。下面分别进行介绍。</p>
<h4>情况1：提案已接受</h4>
<p>如图5所示。X、Y代表客户端，S1到S5是服务端，既代表Proposer又代表Acceptor。为了防止重复，Proposer提出的编号由两部分组成：</p>
<p><code>序列号.Server ID</code></p>
<p>例如S1提出的提案编号，就是1.1、2.1、3.1……</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqs?w=880&amp;h=385" src="/img/bVbreqs?w=880&amp;h=385" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图5 以上图片来自<a href="https://ramcloud.stanford.edu/~ongaro/userstudy/paxos.pdf" rel="nofollow noreferrer" target="_blank">Paxos lecture (Raft user study)</a>第13页</blockquote>
<p>这个过程表示，S1收到客户端的提案X，于是S1作为Proposer，给S1-S3发送Prepare(3.1)请求，由于Acceptor S1-S3没有接受过任何提案，所以接受该提案。然后Proposer S1-S3发送Accept(3.1, X)请求，提案X成功被接受。</p>
<p>在提案X被接受后，S5收到客户端的提案Y，S5给S3-S5发送Prepare(4.5)请求。对S3来说，4.5比3.1大，且已经接受了X，它会回复这个提案 (3.1, X)。S5收到S3-S5的回复后，使用X替换自己的Y，于是发送Accept(4.5, X)请求。S3-S5接受提案。最终所有Acceptor达成一致，都拥有相同的值X。</p>
<p>这种情况的结果是：<strong>新Proposer会使用已接受的提案</strong></p>
<h4>情况2：提案未接受，新Proposer可见</h4>
<p><span class="img-wrap"><img data-src="/img/bVbreqt?w=808&amp;h=278" src="/img/bVbreqt?w=808&amp;h=278" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图6 以上图片来自<a href="https://ramcloud.stanford.edu/~ongaro/userstudy/paxos.pdf" rel="nofollow noreferrer" target="_blank">Paxos lecture (Raft user study)</a>第14页</blockquote>
<p>如图6所示，S3接受了提案(3.1, X)，但S1-S2还没有收到请求。此时S3-S5收到Prepare(4.5)，S3会回复已经接受的提案(3.1, X)，S5将提案值Y替换成X，发送Accept(4.5, X)给S3-S5，对S3来说，编号4.5大于3.1，所以会接受这个提案。</p>
<p>然后S1-S2接受Accept(3.1, X)，最终所有Acceptor达成一致。</p>
<p>这种情况的结果是：<strong>新Proposer会使用已提交的值，两个提案都能成功</strong></p>
<h4>情况3：提案未接受，新Proposer不可见</h4>
<p><span class="img-wrap"><img data-src="/img/bVbreqx?w=789&amp;h=266" src="/img/bVbreqx?w=789&amp;h=266" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图7 以上图片来自<a href="https://ramcloud.stanford.edu/~ongaro/userstudy/paxos.pdf" rel="nofollow noreferrer" target="_blank">Paxos lecture (Raft user study)</a>第15页</blockquote>
<p>如图7所示，S1接受了提案(3.1, X)，S3先收到Prepare(4.5)，后收到Accept(3.1, X)，由于3.1小于4.5，会直接拒绝这个提案。所以提案X无法收到超过半数的回复，这个提案就被阻止了。提案Y可以顺利通过。</p>
<p>这种情况的结果是：<strong>新Proposer使用自己的提案，旧提案被阻止</strong></p>
<h3 id="articleHeader6">活锁 (livelock)</h3>
<p>活锁发生的几率很小，但是会严重影响性能。就是两个或者多个Proposer在Prepare阶段发生互相抢占的情形。</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqy?w=887&amp;h=272" src="/img/bVbreqy?w=887&amp;h=272" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图8 以上图片来自<a href="https://ramcloud.stanford.edu/~ongaro/userstudy/paxos.pdf" rel="nofollow noreferrer" target="_blank">Paxos lecture (Raft user study)</a>第16页</blockquote>
<p>解决方案是Proposer失败之后给一个随机的等待时间，这样就减少同时请求的可能。</p>
<h2 id="articleHeader7">Multi-Paxos</h2>
<p>上一小节提到的活锁，也可以使用Multi-Paxos来解决。它会从Proposer中选出一个Leader，只由Leader提交Proposal，还可以省去Prepare阶段，减少了性能损失。当然，直接把Basic Paxos的多个Proposer的机制搬过来也是可以的，只是性能不够高。</p>
<p>将Basic Paxos并行之后，就可以同时处理多个提案了，因此要能存储不同的提案，也要保证提案的顺序。</p>
<p>Acceptor的结构如图9所示，每个方块代表一个Entry，用于存储提案值。用递增的Index来区分Entry。</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqz?w=480&amp;h=81" src="/img/bVbreqz?w=480&amp;h=81" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图9</blockquote>
<p>Multi-Paxos需要解决几个问题，我们逐个来看。</p>
<h4>1. Leader选举</h4>
<p>一个最简单的选举方法，就是Server ID最大的当Leader。</p>
<p>每个Server间隔T时间向其他Server发送心跳包，如果一个Server在2T时间内没有收到来自更高ID的心跳，那么它就成为Leader。</p>
<p>其他Proposer，必须拒绝客户端的请求，或将请求转发给Leader。</p>
<p>当然，还可以使用其他更复杂的选举方法，这里不再详述。</p>
<h4>2. 省略Prepare阶段</h4>
<p>Prepare的作用是阻止旧的提案，以及检查是否有已接受的提案值。</p>
<p>当只有一个Leader发送提案的时候，Prepare是不会产生冲突的，可以省略Prepare阶段，这样就可以减少一半RPC请求。</p>
<p>Prepare请求的逻辑修改为：</p>
<ul>
<li>Acceptor记录一个全局的最大提案编号</li>
<li>回复最大提案编号，如果当前entry以及之后的所有entry都没有接受任何提案，回复noMoreAccepted</li>
</ul>
<p>当Leader收到超过半数的noMoreAccepted回复，之后就不需要Prepare阶段了，只需要发送Accept请求。直到Accept被拒绝，就重新需要Prepare阶段。</p>
<h4>3. 完整信息流</h4>
<p>目前为止信息是不完整的。</p>
<ul>
<li>Basic Paxos只需超过半数的节点达成一致。但是在Multi-Paxos中，这种方式可能会使一些节点无法得到完整的entry信息。我们希望每个节点都拥有全部的信息。</li>
<li>只有Proposer知道一个提案是否被接受了（根据收到的回复），而Acceptor无法得知此信息。</li>
</ul>
<p>第1个问题的解决方案很简单，就是Proposer给全部节点发送Accept请求。</p>
<p>第2个问题稍微复杂一些。首先，我们可以增加一个Success RPC，让Proposer显式地告诉Acceptor，哪个提案已经被接受了，这个是完全可行的，只不过还可以优化一下，减少请求次数。</p>
<p>我们在Accept请求中，增加一个firstUnchosenIndex参数，表示Proposer的第一个未接受的Index，这个参数隐含的意思是，对该Proposer来说，小于Index的提案都已经被接受了。因此Acceptor可以利用这个信息，把小于Index的提案标记为已接受。另外要注意的是，只能标记该Proposer的提案，因为如果发生Leader切换，不同的Proposer拥有的信息可能不同，不区分Proposer直接标记的话可能会不一致。</p>
<p><span class="img-wrap"><img data-src="/img/bVbreqA?w=493&amp;h=359" src="/img/bVbreqA?w=493&amp;h=359" alt="clipboard.png" title="clipboard.png" style="cursor: pointer; display: inline;"></span></p>
<blockquote>图10</blockquote>
<p>如图10所示，Proposer正在准备提交Index=2的Accept请求，0和1是已接受的提案，因此firstUnchosenIndex=2。当Acceptor收到请求后，比较Index，就可以将Dumplings提案标记为已接受。</p>
<p>由于之前提到的Leader切换的情况，仍然需要显式请求才能获得完整信息。在Acceptor回复Accept消息时，带上自己的firstUnchosenIndex。如果比Proposer的小，那么就需要发送Success(index, value)，Acceptor将收到的index标记为已接受，再回复新的firstUnchosenIndex，如此往复直到两者的index相等。</p>
<h2 id="articleHeader8">总结</h2>
<p>Paxos是分布式一致性问题中的重要共识算法。这篇文章分别介绍了最基础的Basic Paxos，和能够并行的Multi-Paxos。</p>
<p>在Basic Paxos中，介绍了3种基本角色Proposer、Acceptor、Learner，以及提案时可能发生的3种基本情况。在Multi-Paxos中，介绍了3个需要解决的问题：Leader选举、Prepare省略、完整信息流。</p>
<p>在下一篇文章中，我们将实现一个简单的demo来验证这个算法，实现过程将会涉及到更多的细节。</p>
<h2 id="articleHeader9">Reference</h2>
<p><a href="https://draveness.me/consensus" rel="nofollow noreferrer" target="_blank">分布式一致性与共识算法</a></p>
<p><a href="https://yeasy.gitbooks.io/blockchain_guide/content/distribute_system/paxos.html" rel="nofollow noreferrer" target="_blank">Paxos 算法与 Raft 算法</a></p>
<p><a href="https://en.wikipedia.org/wiki/Paxos_%28computer_science%29" rel="nofollow noreferrer" target="_blank">Paxos</a></p>
<p><a href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf" rel="nofollow noreferrer" target="_blank">Paxos Made Simple</a></p>
<p><a href="https://ramcloud.stanford.edu/~ongaro/userstudy/paxos.pdf" rel="nofollow noreferrer" target="_blank">Paxos lecture (Raft user study)</a></p>
<p><a href="https://www.youtube.com/watch?v=JEpsBg0AO6o" rel="nofollow noreferrer" target="_blank">YouTube | Paxos lecture (Raft user study)</a></p>
<h2 id="articleHeader10">版权</h2>
<p>本作品采用<a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="nofollow noreferrer" target="_blank">CC BY 4.0许可协议</a>，转载时请注明链接。</p>

</div>

<div class="clearfix mt10">
<ul class="article-operation list-inline pull-left mt15"><li><a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/"><img class="mb5" src="https://cdn.segmentfault.com/v-5d2ffc9a/global/img/creativecommons-cc.svg" height="20"></a></li><li class="dropdown js__content-ops hidden-xs" data-module="article" data-id="1190000018844326" data-typetext="文章"><a href="javascript:void(0);" class="dropdown-toggle text-muted" data-toggle="dropdown"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></a><ul class="dropdown-menu dropdown-menu-left"><li><a href="#911" data-toggle="modal" data-target="#911" data-action="report">举报</a></li></ul></li></ul>
<div class="pull-right mt-10 hidden-xs">
<div class="widget-share__full" data-text="Paxos共识算法详解" data-url="https://segmentfault.com/a/1190000018844326" data-shorturl="http://sfau.lt/b5breqU"><div class="widget-share-network sharer-0" style="display: block;"><ul class="sn-inline"><li data-network="weibo"><a href="javascript:void(0);" class="entypo-weibo icon-sn-weibo share-1" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至新浪微博">新浪微博</a></li><li data-network="wechart"><a href="javascript:void(0);" class="entypo-wechart icon-sn-weixin share-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至微信">微信</a></li><li data-network="twitter"><a href="javascript:void(0);" class="entypo-twitter icon-sn-twitter share-3" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至 Twitter">Twitter</a></li><li data-network="facebook"><a href="javascript:void(0);" class="entypo-facebook icon-sn-facebook share-4" data-toggle="tooltip" data-placement="top" title="" data-original-title="分享至 Facebook">Facebook</a></li></ul></div><a type="button" class="btn btn-sm shareMore btn-sn-more" data-toggle="popover" data-placement="top" data-url="https://segmentfault.com/a/1190000018844326" data-shorturl="http://sfau.lt/b5breqU"><span class="icon-sn-dotted" data-original-title="" title=""></span><strong class="visible-xs-inline">•••</strong></a></div>


</div>
</div>
<div class="mt10 text-center mb30"><button type="button" id="mainLike" data-id="1190000018844326" class="btn btn-success btn-lg mr15 "><span id="mainLikeText">赞</span>&nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;
<span id="mainLikeNum">1 </span></button><button type="button" id="mainBookmark" data-type="article" data-id="1190000018844326" class="btn btn-default btn-lg "><span id="mainBookmarkText">收藏</span>&nbsp;&nbsp;<span class="seprator">|</span>&nbsp;&nbsp;<span id="mainBookmarkNum">1</span></button></div>                
<script type="text/javascript">
OA_show(3);
</script><div style="text-align: center; line-height: 0; background: #FAFAFA"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 中部横幅广告位 -->
<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-6330872677300335" data-ad-slot="5598290435" data-adsbygoogle-status="done"><ins id="aswift_2_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><ins id="aswift_2_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent;"><iframe width="728" height="90" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;border:0px;width:728px;height:90px;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="beacon_9fa8b6b5e6" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=2&amp;campaignid=1&amp;zoneid=3&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=9fa8b6b5e6" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div></div>


<h4 class="pt20 mb15 mt0 border-top">你可能感兴趣的</h4>

<div id="paradigm-article-related"><div class="recommend-post mb30"><ul class="widget-links"><li><a href="http://segmentfault.com/a/1190000016537965" title="【go共识算法】-DPOS" target="_blank">【go共识算法】-DPOS</a><span class="text-muted">jincheng828</span><a class="tag" taget="_blank" href="/t/golang">golang</a></li><li><a href="http://segmentfault.com/a/1190000016639075" title="【go共识算法】-PBFT" target="_blank">【go共识算法】-PBFT</a><span class="text-muted">jincheng828</span><a class="tag" taget="_blank" href="/t/golang">golang</a></li><li><a href="http://segmentfault.com/a/1190000013128367" title="RSA算法详解" target="_blank">RSA算法详解</a><span class="text-muted">damonare</span><a class="tag" taget="_blank" href="/t/%E5%89%8D%E7%AB%AF">前端</a><a class="tag" taget="_blank" href="/t/https">https</a></li><li><a href="http://segmentfault.com/a/1190000009653403" title="【python】魔法算法详解" target="_blank">【python】魔法算法详解</a><span class="text-muted">ChristmasBoy</span><a class="tag" taget="_blank" href="/t/python">python</a></li><li><a href="http://segmentfault.com/a/1190000013463908" title="从Paxos到NOPaxos 重新理解分布式共识算法（consensus）" target="_blank">从Paxos到NOPaxos 重新理解分布式共识算法（consensus）</a><span class="text-muted">chasel</span><a class="tag" taget="_blank" href="/t/%E4%B8%80%E8%87%B4%E6%80%A7">一致性</a><a class="tag" taget="_blank" href="/t/%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a></li><li><a href="http://segmentfault.com/a/1190000008219057" title="个人文章分类整理" target="_blank">个人文章分类整理</a><span class="text-muted">samsara0511</span><a class="tag" taget="_blank" href="/t/apache">apache</a><a class="tag" taget="_blank" href="/t/vue.js">vue.js</a><a class="tag" taget="_blank" href="/t/html">html</a><a class="tag" taget="_blank" href="/t/javascript">javascript</a><a class="tag" taget="_blank" href="/t/css">css</a></li><li><a href="http://segmentfault.com/a/1190000016540665" title="【go共识算法】-BFT" target="_blank">【go共识算法】-BFT</a><span class="text-muted">jincheng828</span><a class="tag" taget="_blank" href="/t/golang">golang</a></li><li><a href="http://segmentfault.com/a/1190000016535794" title="【go共识算法】-POS" target="_blank">【go共识算法】-POS</a><span class="text-muted">jincheng828</span><a class="tag" taget="_blank" href="/t/golang">golang</a></li></ul></div></div>


<div class="comments--news comments--default comments--article 
" data-id="1190000018844326" data-user-id="" data-author-id="1030000004989641 " data-is-admin="null" id="goToReplyArea">
<div class="mb10 clearfix">
<strong class="comments-stat pull-left mr10">评论</strong>

<div class="btn-group btn-group-xs pull-right comments-sort btn-group-menu" role="menu">
<a href="javascript:;" class="btn btn-default active" data-sort="default">默认排序</a>
<a href="javascript:;" class="btn btn-default" data-sort="desc">时间排序</a>
</div>
</div>
<div class="comments-container">
<div class="comments-list">
</div>
<div class="comments-loading hide">载入中...</div>
<div class="comments-more hide"><a href="javascript:;">显示更多评论</a></div>


<div class="comments-box" id="goToReplyEditor">
<div class="pull-left">
<img class="avatar-32 " src="https://cdn.segmentfault.com/v-5d2ffc9a/global/img/user-128.png" alt="">
</div>
<div class="comments-box-content">
<form action="/api/article/1190000018844326/comments/add">
<div class="form-group mb0">
<textarea name="text" rows="3" class="form-control" placeholder="文明社会，理性评论"></textarea>
<div class="mt15 text-right">
<button type="button" class="hide"></button>
<button class=" btn btn-primary" type="button">发布评论</button>
</div>
</div>
</form>
</div>
</div>
</div>
</div>






</div><!-- /.main -->


<div class="col-md-3 side hidden-sm hidden-xs mt30" style="height: 10742px;">

<div class="mb25 hidden-md hidden-sm hidden-xs">
<img src="https://static.segmentfault.com/sponsor/20190731.png" alt="Planets" usemap="#gridsMap" width="255" height="136">
<map name="gridsMap" id="gridsMap"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" onclick="SFGridAd.c(1750000019629196)" coords="34,34,102,51" href="https://www.apipost.cn/" stitle="可直接生成文档的API调试、管理工具"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" onclick="SFGridAd.c(1750000019772080)" coords="85,68,153,85" href="https://www.fundebug.com/?utm_source=sf_lattice_ad" stitle="一行代码搞定BUG监控"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" onclick="SFGridAd.c(1750000019905470)" coords="102,51,119,68" href="https://jpom-site.keepbx.cn/?s=seg" stitle="一款简而轻的低侵入式在线构建、自动部署、日常运维、项目监控软件"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" onclick="SFGridAd.c(1750000019917190)" coords="204,34,221,51" href="https://dujiaoshou.io?utm_source=sf_ad" stitle="全球独角兽公司排名与招聘"><area shape="rect" target="_blank" onmouseover="SFGridAd.d(this)" onmouseout="SFGridAd.e(this)" onclick="SFGridAd.c(1750000019921445)" coords="170,85,255,136" href="https://mp.weixin.qq.com/mp/homepage?__biz=MjM5NTEwMTAwNg==&amp;hid=3&amp;sn=99867105e8f4618e6dae728547c7e835" stitle="SegmentFault 官方微信公众号"></map>
<div style="text-align: center;"><a style="text-align:center; color:#9E9E9E; font-size:12px" href="/sponsor">想在上方展示你的广告？</a></div>
<script async="" src="https://static.segmentfault.com/sponsor/20190731.js"></script>
</div>

<style>
.job-recommend-area a:not(:last-of-type) {margin-bottom:10px; display: block}
.job-recommend-area a:hover {text-decoration: none;}
</style>
<div class="hidden-md">
<div class="job-recommend">
<h3 class="job-title">推广链接</h3>
<div class="job-recommend-area">
<script type="text/javascript">
OA_show(7);
OA_show(9);
OA_show(10);
OA_show(15);
OA_show(16);
</script><a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=57__zoneid=7__cb=d6c065ed52__oadest=https%3A%2F%2Fsegmentfault.com%2Fls%2F1650000011387052" target="_blank"><strong> Java 微服务实践课</strong><br>
<small style="color: #999">上千人学习过的微服务实栈课</small></a><div id="beacon_d6c065ed52" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=57&amp;campaignid=14&amp;zoneid=7&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=d6c065ed52" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
<a href="https://sponsor.segmentfault.com/ck.php?oaparams=2__bannerid=56__zoneid=9__cb=6a8f882b46__oadest=https%3A%2F%2Fsegmentfault.com%2Fls%2F1650000011318558" target="_blank"><strong>大神的PHP 进阶之路</strong><br>
<small style="color: #999">亿级 PV 项目的架构梳理，性能提升实战</small></a><div id="beacon_6a8f882b46" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=56&amp;campaignid=14&amp;zoneid=9&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=6a8f882b46" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
<div id="beacon_6b8c6af095" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=0&amp;campaignid=0&amp;zoneid=10&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=6b8c6af095" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
<div id="beacon_cd65b6b37f" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=0&amp;campaignid=0&amp;zoneid=15&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=cd65b6b37f" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>
<div id="beacon_b7753af5ce" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=0&amp;campaignid=0&amp;zoneid=16&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=b7753af5ce" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>

</div>
</div>
<style>
.job-recommend {margin-bottom: 30px;}
.job-title {
font-size: 14px;
color: #017E66;
font-weight: 500;
background: #BFE6D7;
margin: 0;
padding-top: 6px;
padding-bottom: 6px;
text-align: center;
}
.job-recommend-area {
padding: 13px;
border: 3px solid #EBF7F3;
border-top: none;
}
</style>
</div>


<div class="hidden-md ad-should-be-fixed stuckMenu" style="display: none; position: relative; top: 0px;">
<div class="mb25 block">
<script type="text/javascript">
OA_show(1);
</script><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 侧栏矩形 -->
<ins class="adsbygoogle" style="display:inline-block;width:255px;height:213px" data-ad-client="ca-pub-6330872677300335" data-ad-slot="9674628595" data-adsbygoogle-status="done"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:213px;margin:0;padding:0;position:relative;visibility:visible;width:255px;background-color:transparent;"><ins id="aswift_3_anchor" style="display:block;border:none;height:213px;margin:0;padding:0;position:relative;visibility:visible;width:255px;background-color:transparent;"><iframe width="255" height="213" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;border:0px;width:255px;height:213px;"></iframe></ins></ins></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><div id="beacon_f22fc5ee4f" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="https://sponsor.segmentfault.com/lg.php?bannerid=1&amp;campaignid=1&amp;zoneid=1&amp;loc=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000018844326&amp;referer=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1uoIyXLmFSARTn7kMme2lFJvYfxkahWa1AZvg0gjVK2ISge4y8DofXyRdzp3z4yVwvYtBJOkORRWQZqDxkLXkK%26wd%3D%26eqid%3Dfb32b017001397d0000000035d41acbc&amp;cb=f22fc5ee4f" width="0" height="0" alt="" style="width: 0px; height: 0px;"></div>

</div>
</div>
<div class="post-nav hidden-xs side-outline hidden-sm" style="display: none; position: sticky; top: 238px; margin-top: 0px;">
<div class="panel panel-default widget-outline">
<div class="panel-heading">目录</div>
<div class="panel-body">
<div class="nav-body" style="overflow: scroll; top: 0px; height: 292px;">
<div class="highlight-title" style="display: none; top: 0px; height: 0px;"></div>
<ul class="articleIndex"><li class=""><a href="#articleHeader0">背景</a></li><li class=""><a href="#articleHeader1">Paxos类型</a></li><li class=""><a href="#articleHeader2">Basic Paxos</a></li><li style="list-style:none;"><ul><li class=""><a href="#articleHeader3">角色</a></li><li class=""><a href="#articleHeader4">算法</a></li><li class=""><a href="#articleHeader5">三种情况</a></li><li class=""><a href="#articleHeader6">活锁 (livelock)</a></li></ul></li><li class=""><a href="#articleHeader7">Multi-Paxos</a></li><li class=""><a href="#articleHeader8">总结</a></li><li class=""><a href="#articleHeader9">Reference</a></li><li class=""><a href="#articleHeader10">版权</a></li></ul>
</div>
</div>
</div>
</div>


</div><!-- /.side -->
</div>
</div>
</div>

参考：
https://segmentfault.com/a/1190000018844326